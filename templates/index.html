<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEMS - Business Expense Management System</title>
    <meta name="description" content="Database Management System for Business Expenses">

    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <script>
        if (window.history.replaceState) {
            window.history.replaceState(null, null, "/");
        }

        // Function to confirm before deleting
        function confirmDelete(id) {
            return confirm(`Are you sure you want to delete record ${id}?`);
        }
    </script>
</head>

<body>
    <header>
        <nav>
            <div class="nav-logo">
                <span class="material-symbols-outlined">database</span>
                <span>Biz<span>Exp</span></span>
            </div>
            <div class="nav-links">
                <a href="/" class="active">Dashboard</a>
            </div>
        </nav>
    </header>

    <main class="container">
        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash {{ category }}">
                        <span class="material-symbols-outlined">
                            {% if category == 'success' %}check_circle{% elif category == 'error' %}error{% else %}info{% endif %}
                        </span>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

		<div class="card">
			<form method="POST" action="/">
				<div class="select-container">
					<label for="table-select">Select Table</label>
					<select name="table_select" id="table-select" class="table-selector" onchange="this.form.submit()">
						{% for table in tables %}
							<option value="{{ table }}" {% if table == selected_table %}selected{% endif %}>
								{{ table | replace('_', ' ') | title }}
							</option>
						{% endfor %}
					</select>
				</div>
			</form>
		
		<!-- Rest of your table form remains the same -->
		</div>
            <form method="POST" action="/add">
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                {% for column in columns %}
                                    <th>{{ column | replace('_', ' ') | title }}</th>
                                {% endfor %}
                                <th>Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                            <!-- Display existing rows -->
                            {% for row in rows %}
                                <tr>
                                    {% for col in columns %}
                                        <td>{{ row[loop.index0] }}</td>
                                    {% endfor %}
                                    <td class="flex gap-1">
                                        <button type="button" class="btn secondary" title="Edit">
                                            <span class="material-symbols-outlined">edit</span>
                                        </button>
                                        <button type="button" class="btn danger" title="Delete" onclick="return confirmDelete('{{ row[0] }}')">
                                            <span class="material-symbols-outlined">delete</span>
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                            
                            <!-- Add new record row -->
                            <tr class="add-row">
                                {% for column in columns %}
                                    <td>
                                        {% if column in auto_inc_fields %}
                                            <input type="text" name="{{ column }}" value="Auto" disabled>
                                        {% elif column in enum_fields %}
                                            <select name="{{ column }}">
                                                {% for val in enum_fields[column] %}
                                                    <option value="{{ val }}">{{ val | replace('_', ' ') | title }}</option>
                                                {% endfor %}
                                            </select>
                                        {% else %}
                                            <input type="text" name="{{ column }}" placeholder="Enter {{ column | replace('_', ' ') | lower }}" required>
                                        {% endif %}
                                    </td>
                                {% endfor %}
                                <td>
                                    <button type="submit" class="flex items-center">
                                        <span class="material-symbols-outlined">add</span>
                                        Add
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </form>
        </div>
    </main>

    <!-- Floating Action Button -->
    <button class="fab" title="Add New Record">
        <span class="material-symbols-outlined">add</span>
    </button>
</body>
</html>